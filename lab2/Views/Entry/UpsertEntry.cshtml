@model UpsertEntryModel
<div class="text-center">
    <p>Add new entry:</p>
    @using (Html.BeginForm(Model.Insert ? "PostAddEntry" : "PostModifyEntry", "Entry", null, FormMethod.Post, true,
    null))
    {
        <table width="100%">
            <tr>
                <td>Date</td>
                <td>@(
                Model.Insert
                ? Html.EditorFor(m => m.Entry.Date)
                : Html.DisplayFor(m => m.Entry.Date)
                )</td>
            </tr>
            <tr>
                <td>Project</td>
                <td>@(
                Model.Insert
                ? @Html.DropDownListFor(m => m.Entry.ActivityCode, Model.Activities)
                : Html.DisplayFor(m => m.Entry.ActivityCode)
                )</td>
            </tr>
            <tr>
                <td>Time</td>
                <td>@Html.EditorFor(m => m.Entry.Time)</td>
            </tr>
            <tr>
                <td>Subcode</td>
                <td>@Html.DropDownListFor(m => m.Entry.SubactivityCode, new List<SelectListItem>())</td>
            </tr>
            <tr>
                <td>Description</td>
                <td>@Html.EditorFor(m => m.Entry.Description)</td>
            </tr>
        </table>
        <input type="submit">
    }
    <input type="button" value="Cancel" onclick="history.back()">
</div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">

    jQuery(document).ready(function () {
        updateSubcodes();
    })

    $("#Entry_ActivityCode").change(function () {
        updateSubcodes();
    });

    var updateSubcodes = function () {
        $.ajax({
            url: '@Url.Action("Subcodes","Activity")',
            type: 'GET',
            data: {
                ActivityCode: $('#Entry_ActivityCode').val(),
            },
            success: function (data) {
                $('#Entry_SubactivityCode').find('option').remove()
                $(data).each(
                    function (index, subcode) {
                        $('#Entry_SubactivityCode').append('<option>' + subcode + '</option>')
                    }
                );
            },
            error: function () { }
        });
    }

</script>